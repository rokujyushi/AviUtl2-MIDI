# MIDI譜表示 (lua-midi 版)

## 概要
AviUtl2 のカスタムオブジェクト `@midi譜表示_luamidi.obj2` によるピアノロール/鍵盤ガイド表示スクリプトです。
[MIDI譜表示](https://hazumurhythm.com/wev/amazon/?script=midi%E8%AD%9C%E8%A1%A8%E7%A4%BAM1d) のパクリです。rikky_moduleに依存せずLuaJIT ベースの `lua-midi` パーサーで動作します。

## 主な特徴
- MIDI ファイル内の任意トラックを選択し、ノート長とベロシティを色で可視化
- テンポ変更や拍子記号を検出し、小節線/拍線を自動生成
- 表示鍵盤数・シフト量・鍵幅や余白などを UI からリアルタイム調整

## インストール / 更新手順
1. フォルダ一式を AviUtl2 の `Script` ディレクトリに配置します。
2. AviUtl2 を再起動し、「カスタムオブジェクト」カテゴリから `@midi譜表示_luamidi` を追加します。

## 使い方
1. オブジェクトのパラメータ `MIDIファイル` で対象 .mid を選択
2. `表示トラック` で "全て" もしくは個別トラック番号を指定
3. 再生位置に合わせて ahead/behind 秒や `時間ずれ_ms` を調整し、画面に収めます。
4. 鍵盤・拍線・色などの表示オプションを必要に応じてオン/オフ
5. `再読み込みキー` を変更するとキャッシュが更新され、外部で編集した MIDI を再読み込みできます。

## 主なパラメータ
| パラメータ | 説明 |
| --- | --- |
| `MIDIファイル` | 読み込む Standard MIDI File (SMF) パス |
| `表示トラック` | 0=全トラック / 1~32 任意トラック |
| `鍵盤数` / `鍵盤シフト` | 画面に表示する鍵数と開始キー |
| `縦スケール_px/秒` | 時間方向のズーム倍率 |
| `先読み秒 / 後読み秒` | 現在時刻を中心に上下へ表示する範囲 |
| `鍵盤表示` / `拍線表示` | 鍵盤とガイドラインの描画切替 |
| `ノート色 / 発音色` | 通常ノート/再生中ノートの色設定 |
| `ライン幅` | 小節線・拍線の太さ |

## 依存ライブラリ
- [rokujyushi/lua-midi (LuaJIT ブランチ)](https://github.com/rokujyushi/lua-midi/tree/LuaJIT)
  - `lua-midi/lib/midi.lua` を本スクリプト同梱で利用しています。MIT License に従い著作権表記を維持しています。

## ライセンス / 開発者
- 本リポジトリは MIT License (c) 2025 rokujyushi で提供されます。詳細は `LICENSE` を参照してください。
